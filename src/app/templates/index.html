{% extends "base.html" %}

{% block app_content %}

<div class="media">
  <div class="media-left">
    <img src="{{current_user.avatar(120)}}" class="media-object" style="width:120px">
  </div>
  <div class="media-body">
    <h4 class="media-heading">
      {{current_user.first_name}} {{current_user.last_name}}</h4>
    <p>({{current_user.username}})</p>
  </div>
</div>
<hr>

    <h1>Dashboard</h1>

    <div>
      Total Activity: {{activity.get_total_images()}} {{activity.get_total_errors()}} {{activity.get_total_submits()}} {{activity.get_total_render_time().total_seconds()}}
    </div>
    <div>
      Day activity: {{activity.get_today_images()}} {{activity.get_today_errors()}} {{activity.get_today_submits()}} {{activity.get_today_render_time().total_seconds()}}
    </div>

    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">Current time</div>
          </div>
          <div class="panel-body">
            <div class="form-horizontal">
              <div class="form-group">
                <label class="col-md-2 control-label">
                  Client time
                </label>
                <div class="col-md-3">
                  <input id="timer" type='text' class="form-control" />
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>

    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">Running projects</div>
          </div>
          <div class="panel-body">
            <div class="table-responsive">
              <div id="running_projects">
              </div>
            </div>
          </div>
      </div>
    </div>

    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">Queue</div>
          </div>
          <div class="panel-body">
            <div class="table-responsive">
              <div id="running_queue">
              </div>
            </div>
          </div>
      </div>
    </div>

{% endblock %}

{% block scripts %}
{{super()}}

{# ajax code #}
<script>
  var myVar = setInterval(myTimer, 1000);

  function myTimer() {
    var d = new Date();
    //var t = d.toLocaleTimeString();
    var t = d.toLocaleString();
    //document.getElementById("timer").innerHTML = t;
    document.getElementById("timer").value= t;
  }


  function update_data() {
    $.get("/ajax/running_data", function(data) {
      $("#running_projects").html(data.projects);
      $("#running_queue").html(data.queue);
    });
  }

  function update_data_cycle() {

    update_data();
    window.setTimeout(update_data_cycle, 60*1000);
  }

  // initial call
  $(document).ready(function() {
  // executes when HTML-Document is loaded and DOM is ready
    update_data_cycle();
  });
</script>

{% endblock %}
