{% extends "dashbase.html" %}

{% block app_content %}

{# #}

<div class="card">
  <h5 class="card-header">Daily Statistics</h5>
  <div class="card-body">
    <div class="col-6">
      <canvas id="dailyChart" width="400" height="200"></canvas>
    </div>
  </div>
</div>

<div class="card mt-3">
  <h5 class="card-header">Last 12 Month Statistics</h5>
  <div class="card-body">
    <div class="col-6">
      <canvas id="monthlyChart" width="400" height="200"></canvas>
    </div>
  </div>
</div>


{% endblock %}

{% block scripts %}
{{super()}}


{# just for info: https://www.codeproject.com/Tips/1156283/Step-by-Step-Way-to-Use-chart-js-with-AngularJS #}
{# used this: https://www.chartjs.org/docs/latest/charts/bar.html #}

<script src="{{url_for('static', filename='scripts/Chart.js')}}"></script>
<!-- <script src="{{url_for('static', filename='scripts/angular.min.js')}}"></script>
<script src="{{url_for('static', filename='scripts/angular-chart.min.js')}}"></script>
<script src="{{url_for('static', filename='scripts/tc-angular-chartjs.min.js')}}"></script> -->


<script>

function get_week(){
  today = new Date();
  wdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
  day = new Date();
  days_set = [];
  for (i = 6; i >= 0; i--) {
    day.setDate(today.getDate()-i);
    s = wdays[day.getDay()] + ' ' + day.getDate();
    days_set.push(s);
  }
  return(days_set);
}



var ctx = document.getElementById('dailyChart').getContext('2d');
var dailyChart = new Chart(ctx, {
    type: 'bar',
    data: {
        //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        //labels: get_week(),
        datasets: [{
            label: '# images',
            data: [0,2,4,6,8,10,12],
            backgroundColor: 'rgba(0.1,0.1,0.1,0.5)',
            borderColor: 'rgba(0,0,0,1)',
            borderWidth: 1
        },
        {
          label: '# error images',
          data: [1,3,5,7,9,11,13],
          backgroundColor: 'rgba(255,0,0,0.5)',
          borderColor: 'rgba(255,0,0,1)',
          borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{

                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});

ctx = document.getElementById('monthlyChart').getContext('2d');
var monthlyChart = new Chart(ctx, {
    type: 'bar',
    data: {
        //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        //labels: get_week(),
        labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
        datasets: [{
            label: '# images',
            data: [0,1,2,3,4,5,6,7,8,9,10,11],
            backgroundColor: 'rgba(0.1,0.1,0.1,0.5)',
            borderColor: 'rgba(0,0,0,1)',
            borderWidth: 1
        },
        {
          label: '# error images',
          data: [11,10,9,8,7,6,5,4,3,2,1,0],
          backgroundColor: 'rgba(255,0,0,0.5)',
          borderColor: 'rgba(255,0,0,1)',
          borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{

                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});


function update_daily_chart() {
  dailyChart.data.labels = get_week();
  dailyChart.update(0);
  $.get("/ajax/stats/daily", function(data) {
    dailyChart.data.datasets[0].data = data.values;
    dailyChart.data.datasets[1].data = data.errors;
    console.log(data);
    dailyChart.update(0);
  });
}


function update_monthly_chart() {
  //monthlyChart.data.labels = get_week();
  //monthlyChart.update(0);
  $.get("/ajax/stats/monthly", function(data) {
    monthlyChart.data.datasets[0].data = data.values;
    monthlyChart.data.datasets[1].data = data.errors;
    monthlyChart.data.labels = data.labels;
    console.log(data);
    monthlyChart.update(0);
  });
}


$(document).ready(function() {
  update_daily_chart();
  update_monthly_chart()
});

</script>

{% endblock %}
