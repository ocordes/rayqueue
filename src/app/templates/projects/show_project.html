{% extends "base.html" %}

{% block app_content %}
    <div class="card border border-primary">
      <img class="card-img-top" src="{{user.avatar(128)}}" alt="Avatar">
      <div class="card-body">
        <h4 class="card-title">{{user.first_name}} {{user.last_name}}</h4>
        <p class="card-text">({{ user.username}})</p>
        <p class="card-text">created: {{ project.timestamp.strftime("%Y-%m-%d %H:%M")}}</p>
      </div>
    </div>


    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">Project</div>
          </div>
          <div class="panel-body">
            <form id="testemailform" class="form-horizontal" role="form" method="post" action="">
                {{form.hidden_tag()}}
                <div class="form-group">
                    <label for="name" class="col-md-2 control-label">
                      {{form.name.label}}
                    </label>
                    <div class="col-md-10">
                      {{form.name(class_="form-control",placeholder="Name",readonly=readonly)}}
                    </div>
                    {% if form.name.errors|length > 0 %}
                    <div id="signupalert" class="alert alert-danger">
                    {% for error in form.name.errors %}
                        <span>{{error}}</span>
                    {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="project_type" class="col-md-2 control-label">
                        {{form.project_type.label}}
                    </label>
                    <div class="col-md-10">
                    {% for subfield in form.project_type %}
                      <label class="radio-inline {{readonly and 'disabled' or ''}}">
                        {{subfield()}} {{subfield.label}}
                      </label>
                    {% endfor %}
                    </div>
                </div>
                <div class="form-group">
                  <label for="version" class="col-md-2 control-label">
                       {{form.version.label}}
                  </label>
                  <div class="col-md-1">
                  {{form.version(class_="form-control",readonly=readonly)}}
                  </div>
                </div>
                <div class="form-group">
                    <label for="is_public" class="col-md-2 control-label">
                        Visibility
                    </label>
                    <div class="col-md-10">
                      <label class="checkbox-inline {{readonly and 'disabled' or ''}}">
                        {{ form.is_public }} {{form.is_public.label}}
                      </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="status" class="col-md-2 control-label">
                      State
                    </label>
                    <div class="col-md-10">
                      <label class="control-label">
                        {{project.state2str}}
                      </label>
                    </div>
                </div>


                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                      {{form.update(class_="btn btn-info", id="btn-update")}}
                   </div>
               </div>
           </form>
         </div>
       </div>
    </div>

    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">BaseFiles</div>
          </div>
          <div class="panel-body">
            <form id="basefilesform" class="form-horizontal" role="form" method="post" action="{{url_for('projects.remove_project_basefile',projectid=project.id)}}">
            <!--<form id="basefilesform" class="form-horizontal" role="form" method="post" action="">-->
              {{ mform.hidden_tag() }}
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <td></td>
                  <td>ID</td>
                  <td>Name</td>
                  <td>Size</td>
                  <td>MD5</td>
                  <td>Created</td>
                </thead>
                {% if project.base_files|length==0 %}
                <tr>
                  <td colspan="6">No files</td>
                </tr>
                {% else %}
                {% for file in project.base_files %}
                <tr>
                  <td>
                    <input type="checkbox" name="files" value="{{file.id}}">
                  </td>
                  <td> {{file.id}} </td>
                  <td> <a href="{{url_for('projects.get_project_file',projectid=project.id,fileid=file.id)}}">{{file.name[37:]}}</a> </td>
                  <td> {{size2human(file.size)}} </td>
                  <td> {{file.md5sum}} </td>
                  <td> {{file.timestamp.strftime("%Y-%m-%d %H:%M")}} </td>
                </tr>
                {% endfor %}
                {% endif %}
              </table>
            </div>
            <div class="form-group">
              <div class="col-md-9">
                <button onclick="checkall('files')" id="btn-checkall" type="button" class="btn btn-info"><i class="icon-hand-right"></i>Select all</button>
                <button onclick="uncheckall('files')" id="btn-uncheckall" type="button" class="btn btn-info"><i class="icon-hand-right"></i>Unselect all</button>
                {{mform.remove(onclick="return (remove_confirm())", class_="btn btn-danger", id="btn-remove")}}
              </div>
            </div>
            </form>

            <div style="border-top: 1px solid#888; padding-top:15px; font-size:85%" >
            <form id="uploadfileform" class="form-horizontal" role="form" method="post" action="{{url_for('projects.upload_project_basefile',projectid=project.id)}}" enctype="multipart/form-data">
              {{ uform.hidden_tag() }}
              <div class="form-group">
                <label for="upload" class="col-md-2 control-label">
                  New file
                </label>
                <label class="col-md-5 btn btn-default btn-file">
                  {{uform.upload()}}
                </label>
                <label class="col-md-2">
                  {{uform.submit(class_="btn btn-info", id="btn-file-upload")}}
                </label>
              </div>
            </form>
            </div>
          </div>
      </div>
    </div>

    <div style="margin-top:50px" class="mainbox">
      <div class="panel panel-info">
          <div class="panel-heading">
              <div class="panel-title">Images</div>
          </div>
          <div class="panel-body">
            <form id="imageform" class="form-horizontal" role="form" method="post" action="{{url_for('projects.remove_project_image',projectid=project.id)}}">
              {{ iform.hidden_tag() }}
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <td></td>
                  <td>ID</td>
                  <td>State</td>
                  <td>Model</td>
                  <td>Created</td>
                  <td>Rendered Image</td>
                  <td>Log file</td>
                  <td>Finished</td>
                </thead>
                {% if project.images|length==0 %}
                {#{% if project.images %}#}
                <tr>
                  <td colspan="8">No files</td>
                </tr>
                {% else %}
                {% for image in project.images %}
                <tr>
                  <td>
                    <input type="checkbox" name="images" value="{{image.id}}">
                  </td>
                  <td><a href="{{url_for('projects.show_image',imageid=image.id)}}">{{image.id}}</a>
                  </td>
                  <td> {{image.state2str}} </td>
                  </td>
                  <td>
                    <a href="{{url_for('projects.get_project_file',projectid=project.id,fileid=image.model)}}">{{image.model}}</a>
                  </td>
                  <td> {{image.created.strftime("%Y-%m-%d %H:%M")}} </td>
                  <td>
                    {% if image.render_image == -1 %}
                    Unavailable
                    {% else %}
                    <a href="{{url_for('projects.get_project_file',projectid=project.id,fileid=image.render_image)}}">{{image.render_image}}</a> </td>
                    {% endif %}
                  </td>
                  <td>
                    {% if image.log_file == -1 %}
                    Unavailable
                    {% else %}
                    <a href="{{url_for('projects.get_project_file',projectid=project.id,fileid=image.log_file)}}">{{image.log_file}}</a> </td>
                    {% endif %}
                  </td>
                  <td> {{image.finished.strftime("%Y-%m-%d %H:%M")}} </td>
                </tr>
                {% endfor %}
                {% endif %}
              </table>
            </div>
            <div class="form-group">
              <div class="col-md-9">
                <button onclick="checkall('images')" id="btn-checkall" type="button" class="btn btn-info"><i class="icon-hand-right"></i>Select all</button>
                <button onclick="uncheckall('images')" id="btn-uncheckall" type="button" class="btn btn-info"><i class="icon-hand-right"></i>Unselect all</button>
                {{iform.remove(onclick="return (remove_confirm())", class_="btn btn-danger", id="btn-remove")}}
              </div>
            </div>
            </form>
          </div>
      </div>
    </div>

<script>
  function checkall(name) {
    var x = document.getElementsByName(name);
    var i;
    for (i = 0; i < x.length; i++) {
      if (x[i].type == "checkbox") {
        x[i].checked = true;
      }
    }
  }

  function uncheckall(name) {
    var x = document.getElementsByName(name);
    var i;
    for (i = 0; i < x.length; i++) {
      if (x[i].type == "checkbox") {
        x[i].checked = false;
      }
    }
  }

  function remove_confirm(){
    return (confirm('Do you really want to remove these items?'))
  }

</script>
{% endblock %}
